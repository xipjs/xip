/*!@license xip github.com/xipjs/xip/Licence*/class N{constructor(e){this.Value=()=>this.value,this.Reg=e=>{let t=this.ID().toString();return this.listeners.set(t,e),()=>{this.listeners.delete(t)}},this.value=e,this.listeners=new Map,this.id=1}Clean(){this.listeners=new Map}Set(e){this.value=e,this.Trigger()}Update(e){this.value=e(this.value),this.Trigger()}Trigger(){var t=Array.from(this.listeners.values());for(let e=0;e<t.length;e++)t[e]()}ID(){return this.id=this.id+1,this.id}}function D(e){return new N(e)}class a{constructor(){}}function f(){let t=[];return{End:()=>{t.forEach(e=>e())},OnEnd:e=>{t.push(e)}}}class R extends a{constructor(e){super(),this.fun=e,this.PrevRens=[],this.busy=!1}PlsRen(t){return new Promise(e=>{this.PrevRens.push([t,e]),this.CheckRens()})}async CheckRens(){let e=this.PrevRens.shift();e?e[0]().then(()=>{e[1](),this.CheckRens()}):this.busy=!1}ToDomNode(e){return this.CDN||(this.CDN=l(this.fun())),this.CDN.ToDomNode(e)}async Remove(){await this.CDN.Remove()}async ReplaceWith(e){await this.CDN.ReplaceWith(e)}async ReRender(t){return new Promise(e=>{this.PrevRens.push([async()=>{var e=this.CDN;this.CDN=l(this.fun()),await e.ReplaceWith(this.CDN.ToDomNode(t))},()=>e(null)]),this.busy||(this.busy=!0,this.CheckRens())})}}class o extends a{constructor(e){super(),this.DomNode=document.createTextNode(e)}ToDomNode(){return this.DomNode}async ReplaceWith(e){this.DomNode.replaceWith(e)}async Remove(){this.DomNode.remove()}async ReRender(){}}class p extends a{constructor(t){super(),this.ChildrenCDN=[];for(let e=0;e<t.length;e++){var s=l(t[e]);this.ChildrenCDN.push(s)}0===this.ChildrenCDN.length&&this.ChildrenCDN.push(new o(""))}ToDomNode(e){return this.DomNode||this.Build(e),this.DomNode}async Remove(){for(let e=0;e<this.ChildrenCDN.length;e++)await this.ChildrenCDN[e].Remove()}async ReRender(t){for(let e=0;e<this.ChildrenCDN.length;e++)await this.ChildrenCDN[e].ReRender(t)}Build(t){var s=document.createDocumentFragment();for(let e=0;e<this.ChildrenCDN.length;e++)s.appendChild(this.ChildrenCDN[e].ToDomNode(t));this.DomNode=s}async ReplaceWith(e){var t=document.createTextNode(""),s=(this.ChildrenCDN[0].ToDomNode(null).parentElement.appendChild(t),[]);for(let e=0;e<this.ChildrenCDN.length;e++)s.push(this.ChildrenCDN[e].Remove());await Promise.all(s),t.replaceWith(e)}}class y extends a{constructor(e,t,s){super(),this.Remove=async()=>{this.Clean();for(let e=0;e<this.OnRemove.length;e++)await this.OnRemove[e](this.DomNode);for(let e=0;e<this.childCDNS.length;e++)await this.childCDNS[e].Remove();this.DomNode.remove()},this.Children=s,this.OnRemove=[],this.Ats=t,this.type=e,this.Renders=[],this.childCDNS=[],this.Cleaners=[]}ToDomNode(e){return this.DomNode||this.Build(e),this.DomNode}Build(t){this.childCDNS=[];let s=document.createElement(this.type);this.Ats.HotProps&&(this.Renders.push(()=>this.AdAts(s,this.Ats.HotProps,t)),delete this.Ats.HotProps),this.AdAts(s,this.Ats,t);for(let e=0;e<this.Children.length;e++){var i=l(this.Children[e]);this.childCDNS.push(i),s.appendChild(i.ToDomNode(t))}this.DomNode=s}Clean(){for(let e=0;e<this.Cleaners.length;e++)this.Cleaners[e]();this.Cleaners=[]}async ReplaceWith(e){for(let e=0;e<this.OnRemove.length;e++)await this.OnRemove[e](this.DomNode);for(let e=0;e<this.childCDNS.length;e++)await this.childCDNS[e].Remove();this.Clean(),this.DomNode.replaceWith(e)}async ReRender(t){for(let e=0;e<this.Renders.length;e++)this.Renders[e]();for(let e=0;e<this.childCDNS.length;e++)await this.childCDNS[e].ReRender(t)}AdAts(n,e,h){Object.keys(e).forEach(s=>{let i=e[s];switch(s){case"x":let e=()=>this.DomNode,t={get el(){return e()},Update:()=>c(e=>this.ReRender(e)),onUpdate:e=>this.Renders.push(e),Remove:this.Remove,onRemove:this.OnRemove.push,Clean:()=>this.Clean(),onClean:e=>this.Cleaners.push(e)};i&&(Array.isArray(i)?i.forEach(e=>{this.Renders.push(e(t))}):i(t));break;case"className":"function"==typeof i?(this.Renders.push(()=>this.DomNode.className=i()),n.className=i()):n.className=i;break;case"reStyle":i&&(i(n.style),this.Renders.push(()=>i(n.style)));break;case"Style":Object.assign(n.style,i);break;case"onRemove":void 0!==i&&this.OnRemove.push(async e=>i(e));break;case"on":Array.isArray(i[0])?i.forEach(e=>{n.addEventListener(e[0],e[1])}):n.addEventListener(i[0],i[1]);break;case"onDom":h.OnEnd(()=>i(n));break;case"focus":n.autofocus=i,n.focus();break;case"class":n.className=i;break;case"onClick":n.addEventListener("click",i);break;case"withRender":i(n);break;case"react":if(i){let t=()=>c(e=>this.ReRender(e));Array.isArray(i)?i.forEach(e=>{this.Cleaners.push(e(t))}):this.Cleaners.push(i(t))}break;default:n.setAttributeNS(null,s,i)}})}}function l(e){if(e instanceof a)return e;switch(typeof e){case"function":return new R(e);case"string":return new o(e);case"number":return new o(e.toString());case"object":return"[object Array]"===Object.prototype.toString.call(e)?new p(e):new o(e.toString());default:if(!e)return new o("");try{return new o(e.toString())}catch{return new o("")}}}async function c(e){var t=f(),e=await e(t);return t.End(),e}function v(t,s){let i;return c(e=>{i=t(),s(i.ToDomNode(e))}),i}function g(e,t,...s){return new y(e,t,s)}Object.assign(globalThis,{el:g,Engage:v,ref:D});
